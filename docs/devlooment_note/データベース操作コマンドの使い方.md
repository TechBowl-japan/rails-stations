# **Railsのデータベース操作コマンド**

## **1. 主要コマンドと実行タイミング**

### **rails db:migrate**
- **実行タイミング**
  - 新しいマイグレーションファイル作成時
  - GitHubからプロジェクトをクローン時
  - 他の開発者のマイグレーションをpull時
- **動作内容**
  - データベースのテーブル構造を更新
  - 未実行のマイグレーションのみ実行
  - 既存のマイグレーションはスキップ

### **rails db:seed**
- **実行タイミング**
  - 初回プロジェクトセットアップ時
  - マスターデータ更新時
  - テストデータリセット時
- **動作内容**
  - `db/seeds.rb`のデータを投入
  - ※重複注意：同じデータを再実行すると重複の可能性あり

## **2. データベースリセットについて**

### **影響を受けるもの（削除される）**
✅ データベース内の全データ
- テーブル内の全レコード
- 例：映画データ、座席データなど

### **影響を受けないもの（保持される）**
❌ ソースコード
- マイグレーションファイル (`db/migrate/`)
- モデルファイル (`app/models/`)
- シードファイル (`db/seeds.rb`)

### **実行例（sheetsテーブルの場合）**
```sql
# リセット前
mysql> SELECT * FROM sheets;
+----+--------+-----+
| id | column | row |
+----+--------+-----+
|  1 |      1 | a   |
|  2 |      2 | a   |
/* ... 他の座席データ ... */
+----+--------+-----+

# リセット後
mysql> SELECT * FROM sheets;
Empty set (0.00 sec)

# シード実行後
mysql> SELECT * FROM sheets;
+----+--------+-----+
| id | column | row |
+----+--------+-----+
|  1 |      1 | a   |
|  2 |      2 | a   |
/* ... 新しく投入された座席データ ... */
+----+--------+-----+
```

## **3. よく使うコマンド一覧**
```bash
# DBを完全にリセットして再セットアップ
docker compose exec web rails db:reset

# マイグレーションとシードを一括実行
docker compose exec web rails db:setup

# シードデータのみをクリアして再投入
docker compose exec web rails db:seed:replant
```

## **4. 実行の必要性判断**

### **再実行が不要な場合**
- マイグレーションが既に実行済み
- シードデータが既に投入済み
- データベースの状態が正常

### **再実行が必要な場合**
- 新しいマイグレーションを追加した
- シードデータを変更した
- データベースをリセットした